<div class="detail-container" *ngFor="let product of productList">
  <div class="product-image">
    <img
      [src]="getImageUrl(product.image_url)"
      alt="{{ product.name }}"
      class="img_product_detail"
    />
  </div>
  <div class="product-info">
    <h2 class="product-name">
      {{ product.name }}
      @if(product.discount > 0) {
      <span class="discount-badge">{{ product.discount }}% OFF</span>
      }
    </h2>
    <p class="brand-name">
      {{ product.brands?.name || 'No Brand' }} - {{ product.categories?.name || 'No Category' }}
    </p>
    @if(product.discount > 0) {
    <div class="price-info">
      <p class="original-price">
        {{ currencyService.convertNumberToCurrency(product.price * 1000) }}
      </p>
      <p class="discounted-price">
        {{
          currencyService.convertNumberToCurrency(
            caculateDiscountedPrice(product.price, product.discount) * 1000
          )
        }}
      </p>
    </div>
    }@else {
    <p class="price">{{ currencyService.convertNumberToCurrency(product.price * 1000) }}</p>

    }
    <p class="description">{{ product.description }}</p>

    @if (getSizeOptions(product).length > 0) {
    <div class="size-selector">
      <label class="size-label">Select Size (ml):</label>
      <div class="size-options">
        @for (size of getSizeOptions(product); track size) {
        <button
          type="button"
          class="size-button"
          [class.selected]="selectedSize === size"
          (click)="selectSize(size)"
        >
          {{ size }} ml
        </button>
        }
      </div>
    </div>
    }

    <!-- Wishlist Message -->
    @if(wishlistMessage) {
    <div class="wishlist-message" [class.success]="isInWishlist">
      {{ wishlistMessage }}
    </div>
    }

    <!-- Action Buttons -->
    <div class="product-actions">
      <app-add-to-cart
        [product]="{
          product_id: product.product_id,
          name: product.name,
          price: product.price * 1000,
          image: getImageUrl(product.image_url),
          code: '#' + product.product_id,
          size_ml: selectedSize,
          options:
            (product.brands?.name || 'No Brand') + ' ‚Ä¢ ' + (product.categories?.name || 'No Category')
        }"
        [showQuantitySelector]="true"
        [showCartInfo]="true"
        [maxQuantity]="10"
        (productAdded)="onProductAdded($event)"
      >
      </app-add-to-cart>

      <button
        type="button"
        class="wishlist-button"
        [class.in-wishlist]="isInWishlist"
        [disabled]="wishlistLoading"
        (click)="toggleWishlist(product.product_id)"
        [title]="isInWishlist ? 'X√≥a kh·ªèi danh s√°ch y√™u th√≠ch' : 'Th√™m v√†o danh s√°ch y√™u th√≠ch'"
      >
        <span class="wishlist-icon">{{ isInWishlist ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
        {{ isInWishlist ? 'Y√™u Th√≠ch' : 'Th√™m Y√™u Th√≠ch' }}
      </button>
    </div>
  </div>
</div>
